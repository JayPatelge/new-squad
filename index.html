<!DOCTYPE html>
<html>
<head>
    <title>Select Option for CARDS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        img {
            max-width: 100%; /* Ensure image scales to viewport width */
            height: auto; /* Maintain aspect ratio */
            margin: 20px 0;
            border: 2px solid #ccc;
            border-radius: 10px;
        }
        .title {
            font-size: calc(20px + 2vw); /* Dynamically scale font size based on viewport */
            text-align: center;
            margin-top: 20px;
        }
        .large-button {
            padding: calc(12px + 1vw) calc(40px + 2vw); /* Dynamically scale button size */
            font-size: calc(16px + 1vw); /* Adjust font size based on viewport */
            border-radius: 10px;
            border: 3px solid black;
            background-color: skyblue;
            cursor: pointer;
        }
        .large-button.selected {
            background-color: gray; /* Highlight selected button */
        }
    </style>
</head>
<body>
    <div class="title">Select Option for CARDS</div>
    <img id="task-image" src="/get_image" alt="Image" style="display:none;">
    <div id="category-options"></div>
    <div id="text" style="font-size: calc(16px + 1vw);"></div>
    <div id="text-category-options"></div>
    <button id="submit-button" disabled class="large-button" style="display:none;">Submit</button>
    <audio id="notification-sound" src="/static/John-Cena-My-Time-Is-Now-(TrendyBeatz.com).mp3" type="audio/mpeg"></audio>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script>
        var socket = io();
        var selectedCategory = null;
        var selectedTextCategory = null;
        var notificationSound = document.getElementById('notification-sound');

        // Create dynamic button
        function createButton(category, isText) {
            var button = document.createElement('button');
            button.textContent = category;
            button.className = 'large-button';
            button.addEventListener('click', () => {
                var previousButton;
                if (isText) {
                    if (selectedTextCategory) {
                        previousButton = document.querySelector('#text-category-options button[category="' + selectedTextCategory + '"]');
                        if (previousButton) {
                            previousButton.classList.remove('selected');
                        }
                    }
                    selectedTextCategory = category;
                } else {
                    if (selectedCategory) {
                        previousButton = document.querySelector('#category-options button[category="' + selectedCategory + '"]');
                        if (previousButton) {
                            previousButton.classList.remove('selected');
                        }
                    }
                    selectedCategory = category;
                }
                button.classList.add('selected'); // Highlight selected button
                if (selectedCategory && selectedTextCategory) {
                    document.getElementById('submit-button').disabled = false;
                    document.getElementById('submit-button').style.display = 'block'; // Ensure button is visible
                }
            });
            button.setAttribute('category', category);
            return button;
        }

        // Fetch task and update UI dynamically
        fetch('/get_task')
            .then(response => response.json())
            .then(data => {
                const taskImage = document.getElementById('task-image');
                const textElement = document.getElementById('text');
                const categoryOptions = document.getElementById('category-options');
                const textCategoryOptions = document.getElementById('text-category-options');

                if (data.has_new_task) {
                    taskImage.style.display = 'block'; // Show image
                    taskImage.src = data.image_path;
                    textElement.textContent = data.text;

                    categoryOptions.innerHTML = '';
                    textCategoryOptions.innerHTML = '';
                    data.categories.forEach(category => {
                        categoryOptions.appendChild(createButton(category, false));
                        textCategoryOptions.appendChild(createButton(category, true));
                    });
                    notificationSound.play(); // Play notification sound
                } else {
                    taskImage.style.display = 'none'; // Hide image
                    textElement.textContent = 'No new tasks available.';
                    categoryOptions.innerHTML = 'No new tasks available.';
                    textCategoryOptions.innerHTML = 'No new tasks available.';
                    document.getElementById('submit-button').style.display = 'none'; // Hide submit button
                }
            });

        // Submit selected category
        document.getElementById('submit-button').addEventListener('click', () => {
            socket.emit('category_selected', { category: selectedCategory });
            socket.emit('text_category_selected', { category: selectedTextCategory });
            selectedCategory = null;
            selectedTextCategory = null;
            document.getElementById('submit-button').disabled = true;
            document.getElementById('submit-button').style.display = 'none'; // Hide submit button
            socket.emit('stop_server');
        });

        // Listen for category updates
        socket.on('category_updated', () => {
            fetch('/get_task')
                .then(response => response.json())
                .then(data => {
                    const taskImage = document.getElementById('task-image');
                    const textElement = document.getElementById('text');
                    const categoryOptions = document.getElementById('category-options');
                    const textCategoryOptions = document.getElementById('text-category-options');

                    if (data.has_new_task) {
                        taskImage.style.display = 'block'; // Show image
                        taskImage.src = data.image_path;
                        textElement.textContent = data.text;

                        categoryOptions.innerHTML = '';
                        textCategoryOptions.innerHTML = '';
                        data.categories.forEach(category => {
                            categoryOptions.appendChild(createButton(category, false));
                            textCategoryOptions.appendChild(createButton(category, true));
                        });
                        notificationSound.play(); // Play notification sound
                    } else {
                        taskImage.style.display = 'none'; // Hide image
                        textElement.textContent = 'No new tasks available.';
                        categoryOptions.innerHTML = 'No new tasks available.';
                        textCategoryOptions.innerHTML = 'No new tasks available.';
                    }
                });
        });
    </script>
</body>
</html>
