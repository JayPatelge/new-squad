<!DOCTYPE html>
<html>
<head>
    <title>Select Option for CARDS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        img {
            max-width: 100%; /* Dynamically adjust image size */
            height: auto; /* Maintain aspect ratio */
            margin: 20px 0;
            border: 2px solid #ccc;
            border-radius: 10px;
            display: none; /* Initially hidden */
        }
        .title {
            font-size: calc(20px + 2vw); /* Dynamically scale font size */
            text-align: center;
            margin-top: 20px;
        }
        .large-button {
            padding: calc(16px + 1vw) calc(40px + 2vw); /* Dynamically scale button size */
            font-size: calc(16px + 1vw); /* Adjust button font size */
            border-radius: 10px;
            border: 3px solid black;
            background-color: skyblue;
            cursor: pointer;
        }
        .large-button.selected {
            background-color: gray; /* Highlight selected button */
        }
        #submit-button {
            margin-top: 20px;
            display: none; /* Hidden until selection is made */
        }
    </style>
</head>
<body>
    <div class="title">Select Option for CARDS</div>
    <img id="task-image" alt="Image">
    <div id="category-options"></div>
    <div id="text" class="title"></div>
    <button id="submit-button" class="large-button" disabled>Submit</button>
    <audio id="notification-sound" src="/static/John-Cena-My-Time-Is-Now-(TrendyBeatz.com).mp3" type="audio/mpeg"></audio>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script>
        const socket = io();
        let selectedCategory = null;
        const notificationSound = document.getElementById('notification-sound');
        const taskImage = document.getElementById('task-image');
        const textElement = document.getElementById('text');
        const categoryOptions = document.getElementById('category-options');
        const submitButton = document.getElementById('submit-button');

        // Function to create dynamic category buttons
        function createButton(category) {
            const button = document.createElement('button');
            button.textContent = category;
            button.className = 'large-button';
            button.addEventListener('click', () => {
                // Reset previous selection
                document.querySelectorAll('.large-button.selected').forEach(btn => btn.classList.remove('selected'));
                selectedCategory = category;
                button.classList.add('selected'); // Highlight selected button
                submitButton.disabled = false;
                submitButton.style.display = 'inline-block'; // Show submit button
            });
            return button;
        }

        // Fetch task and dynamically render UI
        function fetchTask() {
            fetch('/get_task')
                .then(response => response.json())
                .then(data => {
                    if (data.has_new_task) {
                        // Display task
                        taskImage.style.display = 'block'; // Show image
                        taskImage.src = data.image_path;
                        textElement.textContent = data.text;

                        categoryOptions.innerHTML = ''; // Clear previous buttons
                        data.categories.forEach(category => {
                            categoryOptions.appendChild(createButton(category));
                        });

                        notificationSound.play(); // Play notification sound
                    } else {
                        // No task available
                        taskImage.style.display = 'none';
                        textElement.textContent = 'Waiting for task...';
                        categoryOptions.innerHTML = ''; // Clear categories
                        submitButton.style.display = 'none'; // Hide submit button
                    }
                })
                .catch(error => console.error('Error fetching task:', error));
        }

        // Submit selected category
        submitButton.addEventListener('click', () => {
            if (selectedCategory) {
                // Emit selected category
                socket.emit('category_selected', { category: selectedCategory });
                selectedCategory = null; // Reset selection
                submitButton.disabled = true;
                submitButton.style.display = 'none'; // Hide submit button after submission
                console.log('Category submitted!');
            }
        });

        // Listen for category updates via socket
        socket.on('category_updated', () => {
            console.log('Category updated. Fetching task...');
            fetchTask(); // Refresh UI on updates
        });

        // Fetch task on initial load
        fetchTask();
    </script>
</body>
</html>
